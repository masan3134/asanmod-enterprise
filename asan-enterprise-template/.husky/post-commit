#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Post-commit hook - PROD Fix ‚Üí DEV Sync Check
# Rule 9: PROD Fix ‚Üí DEV Sync (MANDATORY!)

# Get last commit message
COMMIT_MSG=$(git log -1 --pretty=%B)
COMMIT_HASH=$(git rev-parse HEAD)

# Check if commit contains [PROD-FIX] tag
if echo "$COMMIT_MSG" | grep -q "\[PROD-FIX\]"; then
  echo ""
  echo "üîÑ PROD Fix detected in commit: $COMMIT_HASH"
  echo "üìã Commit message: $(echo "$COMMIT_MSG" | head -1)"
  echo ""
  echo "‚ö†Ô∏è  PROD Fix ‚Üí DEV Sync check required!"
  echo "   Running: scripts/check-prod-fix-sync.sh"
  echo ""

  # Check if sync script exists
  if [ -f "scripts/mod-tools/check-prod-fix-sync.sh" ]; then
    chmod +x scripts/mod-tools/check-prod-fix-sync.sh
    scripts/mod-tools/check-prod-fix-sync.sh "$COMMIT_HASH"
    SYNC_EXIT_CODE=$?

    if [ $SYNC_EXIT_CODE -eq 0 ]; then
      echo ""
      echo "‚úÖ PROD Fix ‚Üí DEV Sync check completed"
    else
      echo ""
      echo "‚ö†Ô∏è  PROD Fix ‚Üí DEV Sync check found issues"
      echo "   Please review and sync manually if needed"
    fi
  else
    echo "‚ö†Ô∏è  Sync check script not found: scripts/mod-tools/check-prod-fix-sync.sh"
    echo "   Please create the script or sync manually"
  fi

  echo ""
fi

exit 0

